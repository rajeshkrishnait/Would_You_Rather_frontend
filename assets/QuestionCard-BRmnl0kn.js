var fe=t=>{throw TypeError(t)};var $=(t,e,s)=>e.has(t)||fe("Cannot "+s);var i=(t,e,s)=>($(t,e,"read from private field"),s?s.call(t):e.get(t)),y=(t,e,s)=>e.has(t)?fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,r)=>($(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>($(t,e,"access private method"),s);import{S as Oe,p as pe,r as O,s as Z,a as Y,n as Qe,i as ee,b as ve,t as Te,f as _e,c as qe,d as ye,e as Ee,g as x,h as Fe,u as je,j as me,k as E,m as G,l as Ue,o as De,q as Le,v as J,w as be,x as Me,y as Pe,z as ke,A as Be,B as Ve}from"./index-JTuqEpjG.js";var R,o,N,g,_,D,Q,I,H,L,M,q,F,T,P,u,W,te,se,ie,re,ne,ae,oe,Se,xe,Ae=(xe=class extends Oe{constructor(e,s){super();y(this,u);y(this,R);y(this,o);y(this,N);y(this,g);y(this,_);y(this,D);y(this,Q);y(this,I);y(this,H);y(this,L);y(this,M);y(this,q);y(this,F);y(this,T);y(this,P,new Set);this.options=s,d(this,R,e),d(this,I,null),d(this,Q,pe()),this.options.experimental_prefetchInRender||i(this,Q).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,o).addObserver(this),ge(i(this,o),this.options)?p(this,u,W).call(this):this.updateResult(),p(this,u,re).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return he(i(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return he(i(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,u,ne).call(this),p(this,u,ae).call(this),i(this,o).removeObserver(this)}setOptions(e,s){const r=this.options,c=i(this,o);if(this.options=i(this,R).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof O(this.options.enabled,i(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,u,oe).call(this),i(this,o).setOptions(this.options),r._defaulted&&!Z(this.options,r)&&i(this,R).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,o),observer:this});const l=this.hasListeners();l&&Re(i(this,o),c,this.options,r)&&p(this,u,W).call(this),this.updateResult(s),l&&(i(this,o)!==c||O(this.options.enabled,i(this,o))!==O(r.enabled,i(this,o))||Y(this.options.staleTime,i(this,o))!==Y(r.staleTime,i(this,o)))&&p(this,u,te).call(this);const h=p(this,u,se).call(this);l&&(i(this,o)!==c||O(this.options.enabled,i(this,o))!==O(r.enabled,i(this,o))||h!==i(this,T))&&p(this,u,ie).call(this,h)}getOptimisticResult(e){const s=i(this,R).getQueryCache().build(i(this,R),e),r=this.createResult(s,e);return Ne(this,r)&&(d(this,g,r),d(this,D,this.options),d(this,_,i(this,o).state)),r}getCurrentResult(){return i(this,g)}trackResult(e,s){const r={};return Object.keys(e).forEach(c=>{Object.defineProperty(r,c,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(c),s==null||s(c),e[c])})}),r}trackProp(e){i(this,P).add(e)}getCurrentQuery(){return i(this,o)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,R).defaultQueryOptions(e),r=i(this,R).getQueryCache().build(i(this,R),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return p(this,u,W).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,g)))}createResult(e,s){var de;const r=i(this,o),c=this.options,l=i(this,g),h=i(this,_),C=i(this,D),a=e!==r?e.state:i(this,N),{state:f}=e;let n={...f},k=!1,m;if(s._optimisticResults){const b=this.hasListeners(),j=!b&&ge(e,s),U=b&&Re(e,r,s,c);(j||U)&&(n={...n,...qe(f.data,e.options)}),s._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:B,errorUpdatedAt:V,status:w}=n;if(s.select&&n.data!==void 0)if(l&&n.data===(h==null?void 0:h.data)&&s.select===i(this,H))m=i(this,L);else try{d(this,H,s.select),m=s.select(n.data),m=ye(l==null?void 0:l.data,m,s),d(this,L,m),d(this,I,null)}catch(b){d(this,I,b)}else m=n.data;if(s.placeholderData!==void 0&&m===void 0&&w==="pending"){let b;if(l!=null&&l.isPlaceholderData&&s.placeholderData===(C==null?void 0:C.placeholderData))b=l.data;else if(b=typeof s.placeholderData=="function"?s.placeholderData((de=i(this,M))==null?void 0:de.state.data,i(this,M)):s.placeholderData,s.select&&b!==void 0)try{b=s.select(b),d(this,I,null)}catch(j){d(this,I,j)}b!==void 0&&(w="success",m=ye(l==null?void 0:l.data,b,s),k=!0)}i(this,I)&&(B=i(this,I),m=i(this,L),V=Date.now(),w="error");const A=n.fetchStatus==="fetching",K=w==="pending",X=w==="error",ce=K&&A,le=m!==void 0,S={status:w,fetchStatus:n.fetchStatus,isPending:K,isSuccess:w==="success",isError:X,isInitialLoading:ce,isLoading:ce,data:m,dataUpdatedAt:n.dataUpdatedAt,error:B,errorUpdatedAt:V,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>a.dataUpdateCount||n.errorUpdateCount>a.errorUpdateCount,isFetching:A,isRefetching:A&&!K,isLoadingError:X&&!le,isPaused:n.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:X&&le,isStale:ue(e,s),refetch:this.refetch,promise:i(this,Q)};if(this.options.experimental_prefetchInRender){const b=z=>{S.status==="error"?z.reject(S.error):S.data!==void 0&&z.resolve(S.data)},j=()=>{const z=d(this,Q,S.promise=pe());b(z)},U=i(this,Q);switch(U.status){case"pending":e.queryHash===r.queryHash&&b(U);break;case"fulfilled":(S.status==="error"||S.data!==U.value)&&j();break;case"rejected":(S.status!=="error"||S.error!==U.reason)&&j();break}}return S}updateResult(e){const s=i(this,g),r=this.createResult(i(this,o),this.options);if(d(this,_,i(this,o).state),d(this,D,this.options),i(this,_).data!==void 0&&d(this,M,i(this,o)),Z(r,s))return;d(this,g,r);const c={},l=()=>{if(!s)return!0;const{notifyOnChangeProps:h}=this.options,C=typeof h=="function"?h():h;if(C==="all"||!C&&!i(this,P).size)return!0;const v=new Set(C??i(this,P));return this.options.throwOnError&&v.add("error"),Object.keys(i(this,g)).some(a=>{const f=a;return i(this,g)[f]!==s[f]&&v.has(f)})};(e==null?void 0:e.listeners)!==!1&&l()&&(c.listeners=!0),p(this,u,Se).call(this,{...c,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,u,re).call(this)}},R=new WeakMap,o=new WeakMap,N=new WeakMap,g=new WeakMap,_=new WeakMap,D=new WeakMap,Q=new WeakMap,I=new WeakMap,H=new WeakMap,L=new WeakMap,M=new WeakMap,q=new WeakMap,F=new WeakMap,T=new WeakMap,P=new WeakMap,u=new WeakSet,W=function(e){p(this,u,oe).call(this);let s=i(this,o).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Qe)),s},te=function(){p(this,u,ne).call(this);const e=Y(this.options.staleTime,i(this,o));if(ee||i(this,g).isStale||!ve(e))return;const r=Te(i(this,g).dataUpdatedAt,e)+1;d(this,q,setTimeout(()=>{i(this,g).isStale||this.updateResult()},r))},se=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,o)):this.options.refetchInterval)??!1},ie=function(e){p(this,u,ae).call(this),d(this,T,e),!(ee||O(this.options.enabled,i(this,o))===!1||!ve(i(this,T))||i(this,T)===0)&&d(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||_e.isFocused())&&p(this,u,W).call(this)},i(this,T)))},re=function(){p(this,u,te).call(this),p(this,u,ie).call(this,p(this,u,se).call(this))},ne=function(){i(this,q)&&(clearTimeout(i(this,q)),d(this,q,void 0))},ae=function(){i(this,F)&&(clearInterval(i(this,F)),d(this,F,void 0))},oe=function(){const e=i(this,R).getQueryCache().build(i(this,R),this.options);if(e===i(this,o))return;const s=i(this,o);d(this,o,e),d(this,N,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Se=function(e){Ee.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,g))}),i(this,R).getQueryCache().notify({query:i(this,o),type:"observerResultsUpdated"})})},xe);function We(t,e){return O(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function ge(t,e){return We(t,e)||t.state.data!==void 0&&he(t,e,e.refetchOnMount)}function he(t,e,s){if(O(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&ue(t,e)}return!1}function Re(t,e,s,r){return(t!==e||O(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&ue(t,s)}function ue(t,e){return O(e.enabled,t)!==!1&&t.isStaleByTime(Y(e.staleTime,t))}function Ne(t,e){return!Z(t.getCurrentResult(),e)}var Ie=x.createContext(!1),He=()=>x.useContext(Ie);Ie.Provider;function ze(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ye=x.createContext(ze()),Ke=()=>x.useContext(Ye),Xe=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},$e=t=>{x.useEffect(()=>{t.clearReset()},[t])},Ge=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:c})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(c&&t.data===void 0||Fe(s,[t.error,r])),Je=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...s)=>Math.max(e(...s),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Ze=(t,e)=>t.isLoading&&t.isFetching&&!e,et=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,we=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function tt(t,e,s){var n,k,m,B,V;const r=je(),c=He(),l=Ke(),h=r.defaultQueryOptions(t);(k=(n=r.getDefaultOptions().queries)==null?void 0:n._experimental_beforeQuery)==null||k.call(n,h),h._optimisticResults=c?"isRestoring":"optimistic",Je(h),Xe(h,l),$e(l);const C=!r.getQueryCache().get(h.queryHash),[v]=x.useState(()=>new e(r,h)),a=v.getOptimisticResult(h),f=!c&&t.subscribed!==!1;if(x.useSyncExternalStore(x.useCallback(w=>{const A=f?v.subscribe(Ee.batchCalls(w)):me;return v.updateResult(),A},[v,f]),()=>v.getCurrentResult(),()=>v.getCurrentResult()),x.useEffect(()=>{v.setOptions(h,{listeners:!1})},[h,v]),et(h,a))throw we(h,v,l);if(Ge({result:a,errorResetBoundary:l,throwOnError:h.throwOnError,query:r.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw a.error;if((B=(m=r.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||B.call(m,h,a),h.experimental_prefetchInRender&&!ee&&Ze(a,c)){const w=C?we(h,v,l):(V=r.getQueryCache().get(h.queryHash))==null?void 0:V.promise;w==null||w.catch(me).finally(()=>{v.updateResult()})}return h.notifyOnChangeProps?a:v.trackResult(a)}function st(t,e){return tt(t,Ae)}const Ce=({questionText:t,votePercentage:e,flipState:s,onVote:r})=>(console.log(s),E.jsx(G.div,{className:"question__card",onClick:r,animate:{rotateY:s?0:180},transition:{duration:.6},whileHover:["grow"],variants:{grow:{scale:.96}},children:s?E.jsx("div",{className:"question_card-center",children:E.jsx(G.span,{style:{margin:10,height:"fit-content",cursor:"pointer",color:"white",fontWeight:600,fontSize:"43px"},animate:["initial"],variants:{rotate:{rotate:[null,-5,5,0],transition:{duration:10}},initial:{y:[-20,20],rotate:0,transition:{delay:.2,duration:2,repeat:1/0,repeatType:"reverse"}}},children:t})}):E.jsxs(G.span,{style:{margin:10,height:"fit-content",cursor:"pointer",color:"white",fontWeight:600,fontSize:"43px",transform:"scaleX(-1)"},animate:["initial"],initial:{scaleX:-1},variants:{rotate:{rotate:[null,-5,5,0],transition:{duration:10}},initial:{y:[-20,20],rotate:0,transition:{delay:.2,duration:2,repeat:1/0,repeatType:"reverse"}}},children:[e,"%"]})})),at=()=>{const t=Ue(),{history:e,currentIndex:s}=De(a=>a.question),r=e[s]||null,c=x.useRef(null);console.log(e,s);const{refetch:l}=st({queryKey:["randomQuestions"],queryFn:async()=>{const f=(await Be()).map(n=>({questionId:n.question_id,questionOne:n.question_one,questionTwo:n.question_two,voteOne:n.vote_one,voteTwo:n.vote_two,totalVotes:n.total_votes,flipped:!1,voteCompleted:!1}));return t(Ve(f)),f},staleTime:0,enabled:!1}),h=Le({mutationFn:async a=>{const f=e[s];if(f)if(f.voteCompleted)t(Me({questionId:f.questionId}));else{const n=await Pe(f.questionId,a);t(ke({questionId:f.questionId,voteOne:n.vote_one,voteTwo:n.vote_two,totalVotes:n.total_votes,flipped:!0,voteCompleted:!0})),setTimeout(()=>{c.current&&c.current.scrollBy({left:window.innerWidth+20,behavior:"smooth"}),t(J())},1e3)}}});x.useEffect(()=>{(s===0||(s+1)%3===0)&&l()},[s,l]);const C=a=>{c.current&&(a.deltaY>0?t(J()):a.deltaY<0&&t(be()),c.current.scrollBy({left:a.deltaY>0?window.innerWidth+20:-window.innerWidth-20,behavior:"smooth"}))},v=a=>{c.current&&(a.key==="ArrowRight"?(t(J()),c.current.scrollBy({left:window.innerWidth+20,behavior:"smooth"})):a.key==="ArrowLeft"&&(t(be()),c.current.scrollBy({left:-window.innerWidth-20,behavior:"smooth"})))};return x.useEffect(()=>(window.addEventListener("wheel",C),window.addEventListener("keydown",v),()=>{window.removeEventListener("wheel",C),window.removeEventListener("keydown",v)}),[]),r?(console.log(e),E.jsx("div",{className:"Questions",ref:c,children:e==null?void 0:e.map((a,f)=>E.jsxs("div",{className:"Questions__card-wrap",children:[E.jsx(Ce,{questionText:a.questionOne,votePercentage:a.totalVotes>0?(a.voteOne/a.totalVotes*100).toFixed(1):"0.0",flipState:!a.flipped,onVote:()=>h.mutate("vote_one")}),E.jsx("div",{className:"Questions__circle",children:E.jsx("span",{children:" Would you Rather?"})}),E.jsx(Ce,{questionText:a.questionTwo,votePercentage:a.totalVotes>0?(a.voteTwo/a.totalVotes*100).toFixed(1):"0.0",flipState:!a.flipped,onVote:()=>h.mutate("vote_two")})]},f))})):E.jsx("div",{children:"There are no more questions to load! Refresh the site to play again or add more questions!"})};export{at as default};
