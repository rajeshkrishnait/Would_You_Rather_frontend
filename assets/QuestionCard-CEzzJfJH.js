var de=t=>{throw TypeError(t)};var $=(t,e,s)=>e.has(t)||de("Cannot "+s);var i=(t,e,s)=>($(t,e,"read from private field"),s?s.call(t):e.get(t)),y=(t,e,s)=>e.has(t)?de("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,r)=>($(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),f=(t,e,s)=>($(t,e,"access private method"),s);import{S as Oe,p as fe,r as I,s as J,a as Y,n as Qe,i as Z,b as pe,t as Te,f as _e,c as Fe,d as ve,e as Ee,g as x,h as qe,u as je,j as ye,k as O,m as G,l as Le,o as Ue,q as De,v as me,w as be,x as Me,y as Pe,z as ke,A as Ve,B as Be}from"./index-BmAc3bdQ.js";var R,a,N,g,_,U,Q,S,H,D,M,F,q,T,P,u,W,ee,te,se,ie,re,ne,ae,Se,xe,Ae=(xe=class extends Oe{constructor(e,s){super();y(this,u);y(this,R);y(this,a);y(this,N);y(this,g);y(this,_);y(this,U);y(this,Q);y(this,S);y(this,H);y(this,D);y(this,M);y(this,F);y(this,q);y(this,T);y(this,P,new Set);this.options=s,d(this,R,e),d(this,S,null),d(this,Q,fe()),this.options.experimental_prefetchInRender||i(this,Q).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,a).addObserver(this),ge(i(this,a),this.options)?f(this,u,W).call(this):this.updateResult(),f(this,u,ie).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oe(i(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oe(i(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,u,re).call(this),f(this,u,ne).call(this),i(this,a).removeObserver(this)}setOptions(e,s){const r=this.options,c=i(this,a);if(this.options=i(this,R).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof I(this.options.enabled,i(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,u,ae).call(this),i(this,a).setOptions(this.options),r._defaulted&&!J(this.options,r)&&i(this,R).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,a),observer:this});const l=this.hasListeners();l&&Re(i(this,a),c,this.options,r)&&f(this,u,W).call(this),this.updateResult(s),l&&(i(this,a)!==c||I(this.options.enabled,i(this,a))!==I(r.enabled,i(this,a))||Y(this.options.staleTime,i(this,a))!==Y(r.staleTime,i(this,a)))&&f(this,u,ee).call(this);const o=f(this,u,te).call(this);l&&(i(this,a)!==c||I(this.options.enabled,i(this,a))!==I(r.enabled,i(this,a))||o!==i(this,T))&&f(this,u,se).call(this,o)}getOptimisticResult(e){const s=i(this,R).getQueryCache().build(i(this,R),e),r=this.createResult(s,e);return Ne(this,r)&&(d(this,g,r),d(this,U,this.options),d(this,_,i(this,a).state)),r}getCurrentResult(){return i(this,g)}trackResult(e,s){const r={};return Object.keys(e).forEach(c=>{Object.defineProperty(r,c,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(c),s==null||s(c),e[c])})}),r}trackProp(e){i(this,P).add(e)}getCurrentQuery(){return i(this,a)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,R).defaultQueryOptions(e),r=i(this,R).getQueryCache().build(i(this,R),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return f(this,u,W).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,g)))}createResult(e,s){var le;const r=i(this,a),c=this.options,l=i(this,g),o=i(this,_),C=i(this,U),n=e!==r?e.state:i(this,N),{state:v}=e;let h={...v},k=!1,m;if(s._optimisticResults){const b=this.hasListeners(),j=!b&&ge(e,s),L=b&&Re(e,r,s,c);(j||L)&&(h={...h,...Fe(v.data,e.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:V,errorUpdatedAt:B,status:w}=h;if(s.select&&h.data!==void 0)if(l&&h.data===(o==null?void 0:o.data)&&s.select===i(this,H))m=i(this,D);else try{d(this,H,s.select),m=s.select(h.data),m=ve(l==null?void 0:l.data,m,s),d(this,D,m),d(this,S,null)}catch(b){d(this,S,b)}else m=h.data;if(s.placeholderData!==void 0&&m===void 0&&w==="pending"){let b;if(l!=null&&l.isPlaceholderData&&s.placeholderData===(C==null?void 0:C.placeholderData))b=l.data;else if(b=typeof s.placeholderData=="function"?s.placeholderData((le=i(this,M))==null?void 0:le.state.data,i(this,M)):s.placeholderData,s.select&&b!==void 0)try{b=s.select(b),d(this,S,null)}catch(j){d(this,S,j)}b!==void 0&&(w="success",m=ve(l==null?void 0:l.data,b,s),k=!0)}i(this,S)&&(V=i(this,S),m=i(this,D),B=Date.now(),w="error");const A=h.fetchStatus==="fetching",K=w==="pending",X=w==="error",ue=K&&A,ce=m!==void 0,E={status:w,fetchStatus:h.fetchStatus,isPending:K,isSuccess:w==="success",isError:X,isInitialLoading:ue,isLoading:ue,data:m,dataUpdatedAt:h.dataUpdatedAt,error:V,errorUpdatedAt:B,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>n.dataUpdateCount||h.errorUpdateCount>n.errorUpdateCount,isFetching:A,isRefetching:A&&!K,isLoadingError:X&&!ce,isPaused:h.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:X&&ce,isStale:he(e,s),refetch:this.refetch,promise:i(this,Q)};if(this.options.experimental_prefetchInRender){const b=z=>{E.status==="error"?z.reject(E.error):E.data!==void 0&&z.resolve(E.data)},j=()=>{const z=d(this,Q,E.promise=fe());b(z)},L=i(this,Q);switch(L.status){case"pending":e.queryHash===r.queryHash&&b(L);break;case"fulfilled":(E.status==="error"||E.data!==L.value)&&j();break;case"rejected":(E.status!=="error"||E.error!==L.reason)&&j();break}}return E}updateResult(e){const s=i(this,g),r=this.createResult(i(this,a),this.options);if(d(this,_,i(this,a).state),d(this,U,this.options),i(this,_).data!==void 0&&d(this,M,i(this,a)),J(r,s))return;d(this,g,r);const c={},l=()=>{if(!s)return!0;const{notifyOnChangeProps:o}=this.options,C=typeof o=="function"?o():o;if(C==="all"||!C&&!i(this,P).size)return!0;const p=new Set(C??i(this,P));return this.options.throwOnError&&p.add("error"),Object.keys(i(this,g)).some(n=>{const v=n;return i(this,g)[v]!==s[v]&&p.has(v)})};(e==null?void 0:e.listeners)!==!1&&l()&&(c.listeners=!0),f(this,u,Se).call(this,{...c,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,u,ie).call(this)}},R=new WeakMap,a=new WeakMap,N=new WeakMap,g=new WeakMap,_=new WeakMap,U=new WeakMap,Q=new WeakMap,S=new WeakMap,H=new WeakMap,D=new WeakMap,M=new WeakMap,F=new WeakMap,q=new WeakMap,T=new WeakMap,P=new WeakMap,u=new WeakSet,W=function(e){f(this,u,ae).call(this);let s=i(this,a).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Qe)),s},ee=function(){f(this,u,re).call(this);const e=Y(this.options.staleTime,i(this,a));if(Z||i(this,g).isStale||!pe(e))return;const r=Te(i(this,g).dataUpdatedAt,e)+1;d(this,F,setTimeout(()=>{i(this,g).isStale||this.updateResult()},r))},te=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,a)):this.options.refetchInterval)??!1},se=function(e){f(this,u,ne).call(this),d(this,T,e),!(Z||I(this.options.enabled,i(this,a))===!1||!pe(i(this,T))||i(this,T)===0)&&d(this,q,setInterval(()=>{(this.options.refetchIntervalInBackground||_e.isFocused())&&f(this,u,W).call(this)},i(this,T)))},ie=function(){f(this,u,ee).call(this),f(this,u,se).call(this,f(this,u,te).call(this))},re=function(){i(this,F)&&(clearTimeout(i(this,F)),d(this,F,void 0))},ne=function(){i(this,q)&&(clearInterval(i(this,q)),d(this,q,void 0))},ae=function(){const e=i(this,R).getQueryCache().build(i(this,R),this.options);if(e===i(this,a))return;const s=i(this,a);d(this,a,e),d(this,N,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Se=function(e){Ee.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,g))}),i(this,R).getQueryCache().notify({query:i(this,a),type:"observerResultsUpdated"})})},xe);function We(t,e){return I(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function ge(t,e){return We(t,e)||t.state.data!==void 0&&oe(t,e,e.refetchOnMount)}function oe(t,e,s){if(I(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&he(t,e)}return!1}function Re(t,e,s,r){return(t!==e||I(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&he(t,s)}function he(t,e){return I(e.enabled,t)!==!1&&t.isStaleByTime(Y(e.staleTime,t))}function Ne(t,e){return!J(t.getCurrentResult(),e)}var Ie=x.createContext(!1),He=()=>x.useContext(Ie);Ie.Provider;function ze(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ye=x.createContext(ze()),Ke=()=>x.useContext(Ye),Xe=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},$e=t=>{x.useEffect(()=>{t.clearReset()},[t])},Ge=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:c})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(c&&t.data===void 0||qe(s,[t.error,r])),Je=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...s)=>Math.max(e(...s),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Ze=(t,e)=>t.isLoading&&t.isFetching&&!e,et=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,we=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function tt(t,e,s){var h,k,m,V,B;const r=je(),c=He(),l=Ke(),o=r.defaultQueryOptions(t);(k=(h=r.getDefaultOptions().queries)==null?void 0:h._experimental_beforeQuery)==null||k.call(h,o),o._optimisticResults=c?"isRestoring":"optimistic",Je(o),Xe(o,l),$e(l);const C=!r.getQueryCache().get(o.queryHash),[p]=x.useState(()=>new e(r,o)),n=p.getOptimisticResult(o),v=!c&&t.subscribed!==!1;if(x.useSyncExternalStore(x.useCallback(w=>{const A=v?p.subscribe(Ee.batchCalls(w)):ye;return p.updateResult(),A},[p,v]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),x.useEffect(()=>{p.setOptions(o,{listeners:!1})},[o,p]),et(o,n))throw we(o,p,l);if(Ge({result:n,errorResetBoundary:l,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw n.error;if((V=(m=r.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||V.call(m,o,n),o.experimental_prefetchInRender&&!Z&&Ze(n,c)){const w=C?we(o,p,l):(B=r.getQueryCache().get(o.queryHash))==null?void 0:B.promise;w==null||w.catch(ye).finally(()=>{p.updateResult()})}return o.notifyOnChangeProps?n:p.trackResult(n)}function st(t,e){return tt(t,Ae)}const Ce=({questionText:t,votePercentage:e,flipState:s,onVote:r})=>(console.log(s),O.jsx(G.div,{className:"question__card",onClick:r,animate:{rotateY:s?0:180},transition:{duration:.6},whileHover:["grow"],variants:{grow:{scale:.96}},children:s?O.jsx("div",{className:"question_card-center",children:O.jsx(G.span,{style:{margin:10,height:"fit-content",cursor:"pointer",color:"white",fontWeight:600,fontSize:"43px"},animate:["initial"],variants:{rotate:{rotate:[null,-5,5,0],transition:{duration:10}},initial:{y:[-20,20],rotate:0,transition:{delay:.2,duration:2,repeat:1/0,repeatType:"reverse"}}},children:t})}):O.jsxs(G.span,{style:{margin:10,height:"fit-content",cursor:"pointer",color:"white",fontWeight:600,fontSize:"43px",transform:"scaleX(-1)"},animate:["initial"],initial:{scaleX:-1},variants:{rotate:{rotate:[null,-5,5,0],transition:{duration:10}},initial:{y:[-20,20],rotate:0,transition:{delay:.2,duration:2,repeat:1/0,repeatType:"reverse"}}},children:[e,"%"]})})),at=()=>{const t=Le(),{history:e,currentIndex:s}=Ue(n=>n.question),r=e[s]||null,c=x.useRef(null);console.log(e,s);const{refetch:l}=st({queryKey:["randomQuestions"],queryFn:async()=>{const v=(await Ve()).map(h=>({questionId:h.question_id,questionOne:h.question_one,questionTwo:h.question_two,voteOne:h.vote_one,voteTwo:h.vote_two,totalVotes:h.total_votes,flipped:!1,voteCompleted:!1}));return t(Be(v)),v},staleTime:0,enabled:!1}),o=De({mutationFn:async n=>{if(r)if(r.voteCompleted)t(Me({questionId:r.questionId}));else{const v=await Pe(r.questionId,n);t(ke({questionId:r.questionId,voteOne:v.vote_one,voteTwo:v.vote_two,totalVotes:v.total_votes,flipped:!0,voteCompleted:!0}))}}});x.useEffect(()=>{(s===0||(s+1)%3===0)&&l()},[s,l]);const C=n=>{c.current&&(n.deltaY>0?t(me()):n.deltaY<0&&t(be()),c.current.scrollBy({left:n.deltaY>0?window.innerWidth:-window.innerWidth,behavior:"smooth"}))},p=n=>{c.current&&(n.key==="ArrowRight"?(t(me()),c.current.scrollBy({left:window.innerWidth,behavior:"smooth"})):n.key==="ArrowLeft"&&(t(be()),c.current.scrollBy({left:-window.innerWidth,behavior:"smooth"})))};return x.useEffect(()=>(window.addEventListener("wheel",C),window.addEventListener("keydown",p),()=>{window.removeEventListener("wheel",C),window.removeEventListener("keydown",p)}),[]),r?(console.log(e),O.jsx("div",{className:"Questions",ref:c,children:e==null?void 0:e.map((n,v)=>O.jsxs("div",{className:"Questions__card-wrap",children:[O.jsx(Ce,{questionText:n.questionOne,votePercentage:n.totalVotes>0?(n.voteOne/n.totalVotes*100).toFixed(1):"0.0",flipState:!n.flipped,onVote:()=>o.mutate("vote_one")}),O.jsx(Ce,{questionText:n.questionTwo,votePercentage:n.totalVotes>0?(n.voteTwo/n.totalVotes*100).toFixed(1):"0.0",flipState:!n.flipped,onVote:()=>o.mutate("vote_two")})]},v))})):O.jsx("div",{children:"Loading..."})};export{at as default};
